(this.webpackJsonprtc1=this.webpackJsonprtc1||[]).push([[0],[,,,,,,,function(e,n,t){e.exports=t(15)},,,,,function(e,n,t){},function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=13},function(e,n,t){},function(e,n,t){"use strict";t.r(n);var c=t(0),o=t.n(c),r=t(5),a=t.n(r),u=(t(12),t(1)),i=t(2),l=t(3),s=t(6),f=t.n(s),d=(t(14),{names:{}}),p=document.querySelector(".myVideo"),m=document.querySelector(".theyVideo");function b(e,n){switch(n.type){case"name update":return Object(l.a)({},e,{names:Object(l.a)({},e.names,Object(i.a)({},n.payload.peerId,n.payload.name))});default:return e}}function O(){var e=Object(c.useReducer)(b,d),n=Object(u.a)(e,2),t=(n[0],n[1]),r=Object(c.useRef)(new f.a),a=Object(c.useRef)([]),i=Object(c.useState)(null),l=Object(u.a)(i,2),s=l[0],O=l[1],y=Object(c.useState)(""),j=Object(u.a)(y,2),h=j[0],v=j[1],g=Object(c.useState)([]),k=Object(u.a)(g,2),C=k[0],w=k[1],E=Object(c.useCallback)((function(){return a.current.map((function(e){return e.peer})).concat(s)}),[s]),U=Object(c.useCallback)((function(e){a.current.push(e),w(a.current.map((function(e){return e.peer})))}),[]),R=Object(c.useCallback)((function(e){a.current.splice(a.current.findIndex((function(n){return n.peer===e.peer})),1),w(a.current.map((function(e){return e.peer})))}),[]),S=Object(c.useCallback)((function(e,n){if(E().includes(e))console.log("Already connected to ".concat(e,". Aborting."));else{var t=r.current.connect(e,{metadata:{peers:E()}});t.on("open",(function e(){n(t),t.off("open",e)})),t.on("close",(function e(){R(t),t.off("close",e)})),t.on("error",(function(e){return console.error("err",e.message)}))}}),[E,R]),D=Object(c.useCallback)((function(e){U(e),e.on("data",(function(e){"peer discovery"===e.type?e.payload.peers.filter((function(e){return!E().includes(e)})).map((function(e){return S(e,D)})):t(e)}))}),[E,U,S]),I=Object(c.useCallback)((function(e){if(E().includes(e.peer))return console.log("Already connected to ".concat(e.peer,". Closing connection.")),e.close();U(e),e.on("data",(function(e){console.log("handle Incoming Conn",e),"peer discovery"!==e.type&&t(e)}));var n=(e.metadata||{}).peers||[];n.filter((function(e){return!E().includes(e)})).map((function(e){return S(e,D)}));var c=E().filter((function(e){return!n.includes(e)&&e!==s}));c.length>0&&e.send({type:"peer discovery",payload:{peers:c}})}),[E,U,S,D,s]),L=Object(c.useCallback)((function(e){e.on("open",(function n(){I(e);var t=a.current[0].peer;navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){r.current.call(t,e).on("stream",(function(e){"srcObject"in p?p.srcObject=e:p.src=window.URL.createObjectURL(e),p.style.display="block",p.play()}))})).catch((function(){})),e.off("open",n)})),e.on("close",(function n(){R(e),e.off("close",n)})),e.on("error",(function(e){return console.error(e.message)}))}),[I,R]),A=function(e){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(n){console.log("stream",n),e.answer(n),e.on("stream",(function(e){"srcObject"in m?m.srcObject=e:m.src=window.URL.createObjectURL(e),m.style.display="block",m.play()}))})).catch((function(){}))},M=Object(c.useCallback)((function(){r.current.on("open",(function(e){O(e)})),r.current.on("call",A),r.current.on("connection",L)}),[L]),x=Object(c.useCallback)((function(){r.current.off("open",O),r.current.off("call",A),r.current.off("connection",L)}),[L]);Object(c.useEffect)((function(){return M(),x}),[M,x]);var F=Object(c.useCallback)((function(e){e.preventDefault(),v(""),S(h,D)}),[h,S,D]),T=!!h&&h!==s&&!C.find((function(e){return e===h}));return s?o.a.createElement("main",null,o.a.createElement("form",{onSubmit:F},o.a.createElement("input",{autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",spellCheck:"false",autoFocus:!0,onChange:function(e){return v(e.target.value)},value:h,id:"connectTo",placeholder:"Enter known peer id"}),o.a.createElement("button",{type:"submit",disabled:!T},h===s?"That is your ID":C.find((function(e){return e===h}))?"Already connected to that peer":"Connect")),o.a.createElement("h2",null,"Your connections:"),o.a.createElement("ul",null,o.a.createElement("li",{key:s},s," (you)"),C.map((function(e,n){return o.a.createElement("li",{key:e},e)})))):null}function y(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(O,null))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[7,1,2]]]);
//# sourceMappingURL=main.6c1ec2d0.chunk.js.map